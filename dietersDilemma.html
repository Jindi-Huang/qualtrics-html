<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dieter's Dilemma</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useCallback } = React;

    // Configuration - easily adjustable
    const CONFIG = {
      noHeadachePayoff: 2.00,
      headachePayoff: -2.00,
      totalRounds: 100,
      currency: '$',
      
      collider: {
        pFeelGood: 0.50,
        leak: 0.05,
        qDrink: 0.80,
        qFeelGood: 0.80,
      },
      
      drinkName: 'Driftwell',
      chemicalName: 'Qivaryn',
    };

    // Simulate one round based on collider DGP
    function simulateRound(drankBeverage) {
      const { pFeelGood, leak, qDrink, qFeelGood } = CONFIG.collider;
      
      const feelGood = Math.random() < pFeelGood;
      
      let pQivarynAbnormal = (1 - leak);
      if (drankBeverage) {
        pQivarynAbnormal *= (1 - qDrink);
      }
      if (feelGood) {
        pQivarynAbnormal *= (1 - qFeelGood);
      }
      
      const chemicalNormal = Math.random() >= pQivarynAbnormal;
      
      return { chemicalNormal, feelGood };
    }

    // Statistics calculator
    function calculateStats(history) {
      const stats = {
        drinkYes: { total: 0, chemNormal: 0, feelGood: 0 },
        drinkNo: { total: 0, chemNormal: 0, feelGood: 0 },
        chemNormal: { total: 0, feelGood: 0 },
        chemAbnormal: { total: 0, feelGood: 0 },
      };
      
      history.forEach(round => {
        if (round.drankBeverage) {
          stats.drinkYes.total++;
          if (round.chemicalNormal) stats.drinkYes.chemNormal++;
          if (round.feelGood) stats.drinkYes.feelGood++;
        } else {
          stats.drinkNo.total++;
          if (round.chemicalNormal) stats.drinkNo.chemNormal++;
          if (round.feelGood) stats.drinkNo.feelGood++;
        }
        
        if (round.chemicalNormal) {
          stats.chemNormal.total++;
          if (round.feelGood) stats.chemNormal.feelGood++;
        } else {
          stats.chemAbnormal.total++;
          if (round.feelGood) stats.chemAbnormal.feelGood++;
        }
      });
      
      return stats;
    }

    // New Day overlay
    function NewDayOverlay({ show, dayNumber }) {
      if (!show) return null;
      
      return (
        <div className="absolute inset-0 bg-slate-900/95 flex items-center justify-center z-20 rounded-2xl">
          <div className="text-center">
            <div className="text-6xl mb-4">üåÖ</div>
            <div className="text-3xl font-bold text-white">New Day</div>
            <div className="text-xl text-slate-400 mt-2">Day {dayNumber}</div>
          </div>
        </div>
      );
    }

    // BioClip device
    function BioClipLarge({ status, chemicalName }) {
      const getStatusColor = () => {
        if (status === null) return '#64748b';
        return status ? '#22c55e' : '#ef4444';
      };
      
      const getStatusBg = () => {
        if (status === null) return '#1e293b';
        return status ? '#14532d' : '#7f1d1d';
      };
      
      return (
        <div className="flex flex-col items-center">
          <svg viewBox="0 0 120 160" className="w-32 h-44">
            <rect x="10" y="10" width="100" height="140" rx="12" fill="#0f172a" stroke="#334155" strokeWidth="2" />
            <rect x="18" y="20" width="84" height="100" rx="6" fill="#1e293b" />
            <rect x="22" y="24" width="76" height="92" rx="4" fill={getStatusBg()} className="transition-all duration-500" />
            <circle cx="60" cy="55" r="24" fill={getStatusColor()} className="transition-all duration-300">
              {status !== null && (
                <animate attributeName="r" values="24;28;24" dur="0.5s" repeatCount="1" />
              )}
            </circle>
            {status === true && (
              <path d="M48 55 L56 63 L72 47" stroke="white" strokeWidth="4" fill="none" strokeLinecap="round" strokeLinejoin="round">
                <animate attributeName="stroke-dasharray" values="0,100;100,0" dur="0.3s" fill="freeze" />
              </path>
            )}
            {status === false && (
              <g stroke="white" strokeWidth="4" strokeLinecap="round">
                <line x1="50" y1="45" x2="70" y2="65">
                  <animate attributeName="stroke-dasharray" values="0,100;100,0" dur="0.2s" fill="freeze" />
                </line>
                <line x1="70" y1="45" x2="50" y2="65">
                  <animate attributeName="stroke-dasharray" values="0,100;100,0" dur="0.2s" fill="freeze" />
                </line>
              </g>
            )}
            <text x="60" y="100" textAnchor="middle" fill={status === null ? '#64748b' : 'white'} fontSize="11" fontWeight="bold">
              {status === null ? 'READING...' : status ? 'NORMAL' : 'ABNORMAL'}
            </text>
            <rect x="30" y="126" width="60" height="18" rx="4" fill="#334155" />
            <text x="60" y="139" textAnchor="middle" fill="#94a3b8" fontSize="10" fontFamily="monospace">
              BioClip‚Ñ¢
            </text>
            <path d="M0 50 L10 50 L10 110 L0 110 C-4 110 -6 105 -6 100 L-6 60 C-6 55 -4 50 0 50 Z" fill="#475569" />
          </svg>
          <div className="text-lg font-bold text-white mt-2">{chemicalName} Level</div>
        </div>
      );
    }

    // Mood indicator
    function MoodLarge({ mood }) {
      return (
        <div className="flex flex-col items-center">
          <div className={`w-32 h-32 rounded-full flex items-center justify-center transition-all duration-500 ${
            mood === null ? 'bg-slate-700' : mood ? 'bg-gradient-to-br from-emerald-400 to-green-600' : 'bg-gradient-to-br from-rose-400 to-red-600'
          }`}>
            <span className={`text-7xl transition-all duration-300 ${mood === null ? 'grayscale opacity-30' : ''}`}>
              {mood === null ? 'üòê' : mood ? 'üòä' : 'üòî'}
            </span>
          </div>
          <div className="text-lg font-bold text-white mt-3">
            {mood === null ? 'Later this day...' : mood ? 'Headache Free!' : 'Headache'}
          </div>
          {mood !== null && (
            <div className={`text-lg font-bold mt-1 ${mood ? 'text-green-400' : 'text-red-400'}`}>
              {mood ? '+$2' : '-$2'}
            </div>
          )}
        </div>
      );
    }

    // Connection between Qivaryn and Feeling
    function QivarynFeelingConnection({ chemicalStatus, moodStatus, stats, hideRateBox }) {
      const normalGoodRate = stats.chemNormal.total > 0 
        ? Math.round((stats.chemNormal.feelGood / stats.chemNormal.total) * 100) 
        : null;
      const abnormalGoodRate = stats.chemAbnormal.total > 0 
        ? Math.round((stats.chemAbnormal.feelGood / stats.chemAbnormal.total) * 100) 
        : null;
      
      const showConnection = chemicalStatus !== null;
      const connectionColor = chemicalStatus === true ? '#22c55e' : '#ef4444';
      
      return (
        <div className="relative flex items-center justify-center gap-8 py-8">
          <BioClipLarge status={chemicalStatus} chemicalName={CONFIG.chemicalName} />
          
          <div className="flex flex-col items-center relative">
            <svg width="180" height="80" className="absolute top-1/2 -translate-y-1/2">
              <line x1="0" y1="40" x2="180" y2="40" stroke="#334155" strokeWidth="4" strokeDasharray="8,4" />
              {showConnection && (
                <>
                  <line 
                    x1="0" y1="40" x2="180" y2="40" 
                    stroke={connectionColor} 
                    strokeWidth="6" 
                    strokeLinecap="round"
                    opacity="0.5"
                  >
                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="0.5s" repeatCount="indefinite" />
                    <animate attributeName="stroke-dasharray" values="12,12" dur="0.5s" />
                  </line>
                  <circle r="8" fill={connectionColor}>
                    <animate attributeName="cx" values="10;170" dur="0.8s" fill="freeze" />
                    <animate attributeName="cy" values="40;40" dur="0.8s" />
                    <animate attributeName="opacity" values="1;0" dur="0.8s" fill="freeze" />
                  </circle>
                </>
              )}
              <polygon points="170,40 155,30 155,50" fill={showConnection ? connectionColor : '#334155'} className="transition-all duration-300" />
            </svg>
            
            {!hideRateBox && (
              <div className={`bg-slate-800 border-2 rounded-xl px-4 py-3 z-10 transition-all duration-300 ${
                showConnection ? (chemicalStatus ? 'border-green-500' : 'border-red-500') : 'border-slate-600'
              }`}>
                <div className="text-xs text-slate-400 text-center mb-1">
                  {chemicalStatus === null ? 'Historical Rate' : chemicalStatus ? 'When NORMAL' : 'When ABNORMAL'}
                </div>
                <div className="text-3xl font-bold text-center text-white">
                  {chemicalStatus === null ? (
                    <span className="text-slate-500">‚Äî</span>
                  ) : chemicalStatus ? (
                    normalGoodRate !== null ? `${normalGoodRate}%` : '‚Äî'
                  ) : (
                    abnormalGoodRate !== null ? `${abnormalGoodRate}%` : '‚Äî'
                  )}
                </div>
                <div className="text-xs text-slate-400 text-center">
                  headache free
                </div>
              </div>
            )}
          </div>
          
          <MoodLarge mood={moodStatus} />
        </div>
      );
    }

    // Qivaryn Statistics Panel
    function QivarynStatsPanel({ stats, currentChemical }) {
      const normalGoodRate = stats.chemNormal.total > 0 
        ? (stats.chemNormal.feelGood / stats.chemNormal.total * 100).toFixed(0) 
        : null;
      const abnormalGoodRate = stats.chemAbnormal.total > 0 
        ? (stats.chemAbnormal.feelGood / stats.chemAbnormal.total * 100).toFixed(0) 
        : null;
        
      return (
        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 border-2 border-cyan-500/30">
          <h3 className="text-cyan-400 font-bold text-lg mb-4 flex items-center gap-2">
            <span className="text-2xl">üìä</span> {CONFIG.chemicalName} ‚Üí Headache Free
          </h3>
          
          <div className="grid grid-cols-2 gap-4">
            <div className={`rounded-xl p-4 transition-all duration-300 ${
              currentChemical === true ? 'bg-green-900/50 ring-2 ring-green-400' : 'bg-slate-700/50'
            }`}>
              <div className="flex items-center gap-2 mb-2">
                <div className="w-4 h-4 rounded-full bg-green-500" />
                <span className="text-green-400 font-medium">Normal</span>
              </div>
              <div className="text-4xl font-bold text-white mb-1">
                {normalGoodRate !== null ? `${normalGoodRate}%` : '‚Äî'}
              </div>
              <div className="text-sm text-slate-400">
                headache free ({stats.chemNormal.feelGood}/{stats.chemNormal.total})
              </div>
              <div className="mt-3 h-3 bg-slate-600 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-500"
                  style={{ width: normalGoodRate ? `${normalGoodRate}%` : '0%' }}
                />
              </div>
            </div>
            
            <div className={`rounded-xl p-4 transition-all duration-300 ${
              currentChemical === false ? 'bg-red-900/50 ring-2 ring-red-400' : 'bg-slate-700/50'
            }`}>
              <div className="flex items-center gap-2 mb-2">
                <div className="w-4 h-4 rounded-full bg-red-500" />
                <span className="text-red-400 font-medium">Abnormal</span>
              </div>
              <div className="text-4xl font-bold text-white mb-1">
                {abnormalGoodRate !== null ? `${abnormalGoodRate}%` : '‚Äî'}
              </div>
              <div className="text-sm text-slate-400">
                headache free ({stats.chemAbnormal.feelGood}/{stats.chemAbnormal.total})
              </div>
              <div className="mt-3 h-3 bg-slate-600 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-gradient-to-r from-red-500 to-rose-400 transition-all duration-500"
                  style={{ width: abnormalGoodRate ? `${abnormalGoodRate}%` : '0%' }}
                />
              </div>
            </div>
          </div>
          
          {normalGoodRate !== null && abnormalGoodRate !== null && (
            <div className="mt-4 bg-cyan-900/30 rounded-lg p-3 border border-cyan-500/30">
              <div className="text-center">
                <span className="text-cyan-400 text-sm">Difference: </span>
                <span className="text-white font-bold text-xl">
                  {normalGoodRate - abnormalGoodRate > 0 ? '+' : ''}{normalGoodRate - abnormalGoodRate}%
                </span>
                <span className="text-slate-400 text-sm"> more likely to be headache-free when {CONFIG.chemicalName} is normal</span>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Drink decision panel
    function DrinkDecisionPanel({ onChoice, disabled, stats }) {
      const drinkFeelGoodRate = stats.drinkYes.total > 0 
        ? Math.round(stats.drinkYes.feelGood / stats.drinkYes.total * 100) 
        : null;
      const skipFeelGoodRate = stats.drinkNo.total > 0 
        ? Math.round(stats.drinkNo.feelGood / stats.drinkNo.total * 100) 
        : null;
        
      return (
        <div className="bg-slate-800/50 rounded-xl p-4">
          <h4 className="text-slate-400 text-sm font-medium mb-3 text-center">Morning Decision</h4>
          <div className="flex justify-center gap-3">
            <button
              onClick={() => onChoice(true)}
              disabled={disabled}
              className={`px-5 py-3 rounded-lg font-bold transition-all flex items-center gap-2 ${
                disabled 
                  ? 'bg-slate-700 text-slate-500 cursor-not-allowed' 
                  : 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg hover:shadow-xl cursor-pointer'
              }`}
            >
              <span className="text-xl">ü•§</span>
              <div className="text-left">
                <div>Drink</div>
                <div className="text-xs opacity-70">+$0</div>
              </div>
            </button>
            <button
              onClick={() => onChoice(false)}
              disabled={disabled}
              className={`px-5 py-3 rounded-lg font-bold transition-all flex items-center gap-2 ${
                disabled 
                  ? 'bg-slate-700 text-slate-500 cursor-not-allowed' 
                  : 'bg-slate-600 hover:bg-slate-500 text-white shadow-lg hover:shadow-xl cursor-pointer'
              }`}
            >
              <span className="text-xl">‚äò</span>
              <div className="text-left">
                <div>Skip</div>
                <div className="text-xs opacity-70">+$0</div>
              </div>
            </button>
          </div>
          
          <div className="mt-3 space-y-2">
            <div className="grid grid-cols-2 gap-2 text-xs">
              <div className="bg-slate-700/50 rounded p-2 text-center">
                <div className="text-blue-400">Drink ‚Üí {CONFIG.chemicalName}</div>
                <div className="text-white font-bold">
                  {stats.drinkYes.total > 0 
                    ? `${Math.round(stats.drinkYes.chemNormal / stats.drinkYes.total * 100)}% normal`
                    : '‚Äî'}
                </div>
              </div>
              <div className="bg-slate-700/50 rounded p-2 text-center">
                <div className="text-slate-400">Skip ‚Üí {CONFIG.chemicalName}</div>
                <div className="text-white font-bold">
                  {stats.drinkNo.total > 0 
                    ? `${Math.round(stats.drinkNo.chemNormal / stats.drinkNo.total * 100)}% normal`
                    : '‚Äî'}
                </div>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-2 text-xs">
              <div className="bg-slate-700/50 rounded p-2 text-center">
                <div className="text-blue-400">Drink ‚Üí Headache Free</div>
                <div className="text-white font-bold">
                  {drinkFeelGoodRate !== null ? `${drinkFeelGoodRate}%` : '‚Äî'}
                </div>
              </div>
              <div className="bg-slate-700/50 rounded p-2 text-center">
                <div className="text-slate-400">Skip ‚Üí Headache Free</div>
                <div className="text-white font-bold">
                  {skipFeelGoodRate !== null ? `${skipFeelGoodRate}%` : '‚Äî'}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Recent history
    function CompactHistory({ history }) {
      const recentRounds = history.slice().reverse().slice(0, 8);
      
      return (
        <div className="bg-slate-800/50 rounded-xl p-4">
          <h4 className="text-slate-400 text-sm font-medium mb-3">All Days</h4>
          <div className="space-y-1">
            {recentRounds.map((round) => (
              <div key={round.roundNumber} className="flex items-center gap-2 text-sm py-1 px-2 bg-slate-700/30 rounded">
                <span className="text-slate-500 w-6">#{round.roundNumber}</span>
                <span className={`w-12 ${round.drankBeverage ? 'text-blue-400' : 'text-slate-500'}`}>
                  {round.drankBeverage ? 'ü•§' : '‚äò'}
                </span>
                <span className={`flex-1 font-medium ${round.chemicalNormal ? 'text-green-400' : 'text-red-400'}`}>
                  {round.chemicalNormal ? 'Normal' : 'Abnormal'}
                </span>
                <span className={`text-2xl w-10 h-10 flex items-center justify-center rounded-lg ${
                  round.feelGood ? 'bg-green-600' : 'bg-red-600'
                }`}>
                  {round.feelGood ? 'üòä' : 'üòî'}
                </span>
              </div>
            ))}
            {history.length === 0 && (
              <p className="text-slate-500 text-center py-4">No days yet</p>
            )}
          </div>
        </div>
      );
    }

    // Main experiment component
    function BeverageExperiment() {
      const [currentRound, setCurrentRound] = useState(1);
      const [phase, setPhase] = useState('decision');
      const [history, setHistory] = useState([]);
      const [currentChoice, setCurrentChoice] = useState(null);
      const [currentChemical, setCurrentChemical] = useState(null);
      const [currentMood, setCurrentMood] = useState(null);
      const [showNewDay, setShowNewDay] = useState(false);
      const [hideRateBox, setHideRateBox] = useState(false);
      const [nextDayNumber, setNextDayNumber] = useState(2);
      const [totalEarnings, setTotalEarnings] = useState(0);
      const [selectedPaymentRound, setSelectedPaymentRound] = useState(null);
      
      const stats = calculateStats(history);
      
      const handleChoice = useCallback((drinkChoice) => {
        setCurrentChoice(drinkChoice);
        setPhase('chemical');
        
        const result = simulateRound(drinkChoice);
        
        setTimeout(() => {
          setCurrentChemical(result.chemicalNormal);
          
          setTimeout(() => {
            setPhase('outcome');
            setCurrentMood(result.feelGood);
            
            const earnings = result.feelGood ? CONFIG.noHeadachePayoff : CONFIG.headachePayoff;
            
            const roundData = {
              roundNumber: currentRound,
              drankBeverage: drinkChoice,
              chemicalNormal: result.chemicalNormal,
              feelGood: result.feelGood,
              earnings: earnings,
            };
            
            setHistory(prev => [...prev, roundData]);
            setTotalEarnings(prev => prev + earnings);
            
            if (currentRound >= CONFIG.totalRounds) {
              setTimeout(() => {
                const paymentRound = Math.floor(Math.random() * CONFIG.totalRounds) + 1;
                setSelectedPaymentRound(paymentRound);
                setPhase('complete');
              }, 2000);
            } else {
              setTimeout(() => {
                setHideRateBox(true);
                setNextDayNumber(currentRound + 1);
                
                setTimeout(() => {
                  setShowNewDay(true);
                  
                  setTimeout(() => {
                    setShowNewDay(false);
                    setHideRateBox(false);
                    setCurrentRound(prev => prev + 1);
                    setPhase('decision');
                    setCurrentChoice(null);
                    setCurrentChemical(null);
                    setCurrentMood(null);
                  }, 1000);
                }, 100);
              }, 1400);
            }
          }, 1200);
        }, 800);
      }, [currentRound]);
      
      // Experiment complete screen
      if (phase === 'complete') {
        const paymentRoundData = history[selectedPaymentRound - 1];
        const normalGoodRate = stats.chemNormal.total > 0 
          ? Math.round(stats.chemNormal.feelGood / stats.chemNormal.total * 100) 
          : 0;
        const abnormalGoodRate = stats.chemAbnormal.total > 0 
          ? Math.round(stats.chemAbnormal.feelGood / stats.chemAbnormal.total * 100) 
          : 0;
        const drinkGoodRate = stats.drinkYes.total > 0 
          ? Math.round(stats.drinkYes.feelGood / stats.drinkYes.total * 100) 
          : 0;
        const skipGoodRate = stats.drinkNo.total > 0 
          ? Math.round(stats.drinkNo.feelGood / stats.drinkNo.total * 100) 
          : 0;
          
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-xl w-full">
              <div className="text-center">
                <div className="text-6xl mb-4">üéâ</div>
                <h1 className="text-3xl font-bold text-gray-800 mb-2">Experiment Complete!</h1>
                <p className="text-gray-600 mb-6">Thank you for participating in all {CONFIG.totalRounds} rounds.</p>
              </div>
              
              <div className="bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl p-5 text-white mb-4">
                <h3 className="font-bold mb-3 text-lg">üìä {CONFIG.chemicalName} ‚Üí Headache Free</h3>
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white/20 rounded-lg p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <div className="w-3 h-3 rounded-full bg-green-400" />
                      <span className="text-sm">When Normal</span>
                    </div>
                    <div className="text-3xl font-bold">{normalGoodRate}%</div>
                    <div className="text-xs opacity-80">headache free</div>
                  </div>
                  <div className="bg-white/20 rounded-lg p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <div className="w-3 h-3 rounded-full bg-red-400" />
                      <span className="text-sm">When Abnormal</span>
                    </div>
                    <div className="text-3xl font-bold">{abnormalGoodRate}%</div>
                    <div className="text-xs opacity-80">headache free</div>
                  </div>
                </div>
              </div>
              
              <div className="bg-gray-100 rounded-xl p-4 mb-4">
                <h3 className="font-bold mb-3 text-gray-700">ü•§ Drink ‚Üí Headache Free</h3>
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white rounded-lg p-3 border border-gray-200">
                    <div className="text-sm text-gray-500">When Drank</div>
                    <div className="text-2xl font-bold text-gray-800">{drinkGoodRate}%</div>
                    <div className="text-xs text-gray-500">headache free ({stats.drinkYes.feelGood}/{stats.drinkYes.total})</div>
                  </div>
                  <div className="bg-white rounded-lg p-3 border border-gray-200">
                    <div className="text-sm text-gray-500">When Skipped</div>
                    <div className="text-2xl font-bold text-gray-800">{skipGoodRate}%</div>
                    <div className="text-xs text-gray-500">headache free ({stats.drinkNo.feelGood}/{stats.drinkNo.total})</div>
                  </div>
                </div>
              </div>
              
              <div className="bg-emerald-50 border-2 border-emerald-200 rounded-xl p-5">
                <p className="text-sm text-emerald-600 mb-1">Payment Round Selected</p>
                <p className="text-2xl font-bold text-emerald-800 mb-2">Round #{selectedPaymentRound}</p>
                <div className="text-sm text-emerald-700">
                  {paymentRoundData.drankBeverage ? 'ü•§ Drank' : '‚äò Skipped'} ‚Üí 
                  {paymentRoundData.chemicalNormal ? ' Normal' : ' Abnormal'} ‚Üí 
                  {paymentRoundData.feelGood ? ' üòä Headache Free' : ' üòî Headache'}
                </div>
                <p className="text-3xl font-bold text-emerald-800 mt-2">
                  {paymentRoundData.earnings >= 0 ? '+' : ''}{CONFIG.currency}{paymentRoundData.earnings.toFixed(2)}
                </p>
              </div>
            </div>
          </div>
        );
      }
      
      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4">
          <div className="max-w-5xl mx-auto">
            <div className="flex items-center justify-between mb-4">
              <div className="bg-white/10 backdrop-blur rounded-xl px-5 py-3">
                <div className="flex items-center gap-4">
                  <div>
                    <span className="text-white/60 text-sm">Day</span>
                    <div className="text-white text-3xl font-bold">{currentRound}</div>
                  </div>
                  <div className="text-white/40 text-2xl">/</div>
                  <div className="text-white/60 text-xl">{CONFIG.totalRounds}</div>
                </div>
                <div className="w-40 h-2 bg-white/20 rounded-full mt-2 overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-cyan-400 to-blue-500 transition-all duration-300"
                    style={{ width: `${(currentRound / CONFIG.totalRounds) * 100}%` }}
                  />
                </div>
              </div>
            </div>
            
            <div className="bg-slate-800/50 backdrop-blur rounded-2xl p-6 mb-4 border border-slate-700 relative overflow-hidden">
              <NewDayOverlay show={showNewDay} dayNumber={nextDayNumber} />
              
              <QivarynFeelingConnection 
                chemicalStatus={currentChemical} 
                moodStatus={currentMood}
                stats={stats}
                hideRateBox={hideRateBox}
              />
              
              <div className="text-center mt-4">
                <span className={`inline-block px-4 py-2 rounded-full text-sm font-medium ${
                  phase === 'decision' ? 'bg-blue-500/20 text-blue-300 border border-blue-500/30' :
                  phase === 'chemical' ? 'bg-amber-500/20 text-amber-300 border border-amber-500/30' :
                  'bg-green-500/20 text-green-300 border border-green-500/30'
                }`}>
                  {phase === 'decision' && `Morning: Will you drink ${CONFIG.drinkName}?`}
                  {phase === 'chemical' && `Reading your ${CONFIG.chemicalName} level...`}
                  {phase === 'outcome' && `Later this day: ${currentMood ? 'Headache free! üòä' : 'Headache üòî'}`}
                </span>
              </div>
            </div>
            
            <div className="grid grid-cols-3 gap-4">
              <DrinkDecisionPanel 
                onChoice={handleChoice} 
                disabled={phase !== 'decision'}
                stats={stats}
              />
              <QivarynStatsPanel stats={stats} currentChemical={currentChemical} />
              <CompactHistory history={history} />
            </div>
          </div>
        </div>
      );
    }

    // Render the app
    ReactDOM.createRoot(document.getElementById('root')).render(<BeverageExperiment />);
  </script>
</body>
</html>
