<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instructions</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; padding: 0; background: #ffffff; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    // =============== QUALTRICS COMMUNICATION ===============
    let participantId = null;
    let gameId = null;

    window.addEventListener('message', function(event) {
      if (event.data.type === 'INIT') {
        console.log('Received INIT from Qualtrics:', event.data);
        participantId = event.data.participantId;
        gameId = event.data.gameId;

        if (event.data.gameConfig) {
          const qConfig = event.data.gameConfig;
          if (qConfig.currency) CONFIG.currency = qConfig.currency;
          if (qConfig.basePay !== undefined) CONFIG.basePay = qConfig.basePay;
          if (qConfig.aCost !== undefined) CONFIG.aCost = qConfig.aCost;
          if (qConfig.yBonus !== undefined) CONFIG.yBonus = qConfig.yBonus;
          if (qConfig.nRounds !== undefined) CONFIG.nRounds = qConfig.nRounds;
          if (qConfig.playerName0) CONFIG.playerName0 = qConfig.playerName0;
          if (qConfig.playerName1) CONFIG.playerName1 = qConfig.playerName1;
          if (qConfig.playerIcon0) CONFIG.playerIcon0 = qConfig.playerIcon0;
          console.log('Applied config:', CONFIG);
        }

        markInitialized();
      }
    });

    function sendDataToQualtrics(dataType, data) {
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'GAME_DATA',
          gameId: gameId,
          dataType: dataType,
          data: data,
          participantId: participantId,
          timestamp: new Date().toISOString()
        }, '*');
      }
      console.log('Sent to Qualtrics:', dataType, data);
    }

    let isInitialized = false;
    let initCallbacks = [];

    function onInitialized(callback) {
      if (isInitialized) callback();
      else initCallbacks.push(callback);
    }

    function markInitialized() {
      isInitialized = true;
      initCallbacks.forEach(cb => cb());
      initCallbacks = [];
    }

    // Configuration
    const CONFIG = {
      currency: '$',
      basePay: 2.00,
      aCost: 0.00,
      yBonus: 2.00,
      nRounds: 10,
      playerName0: 'Driftwell',
      playerName1: 'Qivaryn',
      playerIcon0: 'ü•§'
    };

    // Example drink-chemical pairs for illustration
    const EXAMPLES = [
      { drink: 'Driftwell', chemical: 'Qivaryn', icon: 'ü•§' },
      { drink: 'Clearhaven', chemical: 'Zerqalase', icon: 'üßã' },
      { drink: 'Melloway', chemical: 'Melythor', icon: 'üç∂' }
    ];
  </script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Mini BioClip illustration (matches BioClipLarge from dietersDilemma.html)
    function BioClipMini({ status }) {
      const getStatusColor = () => {
        if (status === null) return '#64748b';
        return status === 1 ? '#22c55e' : '#ef4444';
      };

      const getStatusBg = () => {
        if (status === null) return '#1e293b';
        return status === 1 ? '#14532d' : '#7f1d1d';
      };

      return (
        <svg viewBox="0 0 120 160" className="w-24 h-32">
          <rect x="10" y="10" width="100" height="140" rx="12" fill="#0f172a" stroke="#334155" strokeWidth="2" />
          <rect x="18" y="20" width="84" height="100" rx="6" fill="#1e293b" />
          <rect x="22" y="24" width="76" height="92" rx="4" fill={getStatusBg()} />
          <circle cx="60" cy="55" r="24" fill={getStatusColor()} />
          {status === 1 && (
            <path d="M48 55 L56 63 L72 47" stroke="white" strokeWidth="4" fill="none" strokeLinecap="round" strokeLinejoin="round" />
          )}
          {status === 0 && (
            <g stroke="white" strokeWidth="4" strokeLinecap="round">
              <line x1="50" y1="45" x2="70" y2="65" />
              <line x1="70" y1="45" x2="50" y2="65" />
            </g>
          )}
          <text x="60" y="100" textAnchor="middle" fill={status === null ? '#64748b' : 'white'} fontSize="11" fontWeight="bold">
            {status === null ? 'READING...' : status === 1 ? 'NORMAL' : 'ABNORMAL'}
          </text>
          <rect x="30" y="126" width="60" height="18" rx="4" fill="#334155" />
          <text x="60" y="139" textAnchor="middle" fill="#94a3b8" fontSize="10" fontFamily="monospace">BioClip‚Ñ¢</text>
          <path d="M0 50 L10 50 L10 110 L0 110 C-4 110 -6 105 -6 100 L-6 60 C-6 55 -4 50 0 50 Z" fill="#475569" />
        </svg>
      );
    }

    // Mood indicator mini (matches MoodLarge from dietersDilemma.html)
    function MoodMini({ mood }) {
      return (
        <div className={`w-20 h-20 rounded-full flex items-center justify-center transition-all duration-500 ${
          mood === null ? 'bg-gray-200' : mood === 1 ? 'bg-gradient-to-br from-emerald-400 to-green-600' : 'bg-gradient-to-br from-rose-400 to-red-600'
        }`}>
          <span className={`text-5xl ${mood === null ? 'grayscale opacity-40' : ''}`}>
            {mood === null ? 'üò∂' : mood === 1 ? 'üòä' : 'üòî'}
          </span>
        </div>
      );
    }

    // Drink button mini
    function DrinkButtonMini({ icon, name, type }) {
      const bgColor = 'bg-blue-600';
      return (
        <div className={`w-20 py-2 rounded-lg flex items-center justify-center gap-2 ${bgColor} text-white`}>
          {icon && <span className="text-xl">{icon}</span>}
          <span className="text-sm font-bold">{name}</span>
        </div>
      );
    }

    // Main Instructions Component
    function Instructions() {
      const [ready, setReady] = useState(false);
      const [currentPage, setCurrentPage] = useState(0);
      const [attentionCheck, setAttentionCheck] = useState(0);
      const [comprehension, setComprehension] = useState({});
      const [wrongCountQ1, setWrongCountQ1] = useState(0);
      const [wrongCountQ2, setWrongCountQ2] = useState(0);
      const [allAnswersQ1, setAllAnswersQ1] = useState([]);
      const [allAnswersQ2, setAllAnswersQ2] = useState([]);
      const [q1Error, setQ1Error] = useState(null);
      const [q2Error, setQ2Error] = useState(null);
      const totalPages = 7;

      const [q1Items] = useState(() => shuffleArray([
        { id: 'drinkNoPay', text: `Whether I drink the beverage or not does${'\u00A0'}`, underline: 'not', after: ` affect my payment.` },
        { id: 'drinkCost', text: `Drinking the beverage will cost ${CONFIG.currency}${CONFIG.aCost.toFixed(2)}.` },
        { id: 'feelGoodBonus', text: `If I feel good at the end of the day, I'll receive an additional ${CONFIG.currency}${CONFIG.yBonus.toFixed(2)} bonus.` },
        { id: 'oneRound', text: 'My overall payment will be determined by one round randomly selected from throughout the study.' },
        { id: 'sumAll', text: 'My overall payment will be the sum of all the payments I collect over all rounds I play.' },
        { id: 'bioClipPay', text: 'My blood chemical levels measured by BioClip directly affects my payment.' }
      ]));

      const [q2Items] = useState(() => shuffleArray([
        { id: 'normalCausesGood', text: `If my BioClip shows a normal chemical level and I later feel good, this means that the normal chemical level caused me to feel good.` },
        { id: 'normalNotCausesGood', text: `If my BioClip shows a normal chemical level and I later feel good, this does `, underline: 'not', after: ` mean that the normal chemical level caused me to feel good.` },
        { id: 'twoVersions', text: `Each blood chemical has two possibilities: either it is a cause of how you feel, or is a response to how you feel. Different chemicals may work in different ways.` }
      ]));

      const q1Correct = new Set(['drinkCost', 'feelGoodBonus', 'oneRound']);
      const q1All = ['drinkNoPay', 'drinkCost', 'feelGoodBonus', 'oneRound', 'sumAll', 'bioClipPay'];
      const q2Correct = new Set(['normalNotCausesGood', 'twoVersions']);
      const q2All = ['normalCausesGood', 'normalNotCausesGood', 'twoVersions'];

      const checkAnswer = (items, correctSet) => {
        const selected = new Set(items.filter(id => comprehension[id]));
        if (selected.size !== correctSet.size) return false;
        for (const id of correctSet) { if (!selected.has(id)) return false; }
        return true;
      };

      useEffect(() => {
        const timeout = setTimeout(() => {
          if (!ready) {
            console.log('Timeout: starting with default config');
            setReady(true);
          }
        }, 3000);

        onInitialized(() => {
          clearTimeout(timeout);
          setReady(true);
        });

        return () => clearTimeout(timeout);
      }, []);

      const handleContinue = () => {
        const q1Selected = q1All.filter(id => comprehension[id]);
        const q2Selected = q2All.filter(id => comprehension[id]);
        const q1Ok = checkAnswer(q1All, q1Correct);
        const q2Ok = checkAnswer(q2All, q2Correct);

        let newWrongQ1 = wrongCountQ1;
        let newWrongQ2 = wrongCountQ2;
        let newAllQ1 = [...allAnswersQ1];
        let newAllQ2 = [...allAnswersQ2];

        if (!q1Ok) {
          newWrongQ1 = wrongCountQ1 + 1;
          setWrongCountQ1(newWrongQ1);
          newAllQ1 = [...allAnswersQ1, q1Selected];
          setAllAnswersQ1(newAllQ1);
          setQ1Error('Your answer to Question 1 is incorrect. Please try again.');
        } else {
          setQ1Error(null);
          if (!allAnswersQ1.length || !q1Ok) {
            newAllQ1 = [...allAnswersQ1, q1Selected];
            setAllAnswersQ1(newAllQ1);
          }
        }

        if (!q2Ok) {
          newWrongQ2 = wrongCountQ2 + 1;
          setWrongCountQ2(newWrongQ2);
          newAllQ2 = [...allAnswersQ2, q2Selected];
          setAllAnswersQ2(newAllQ2);
          setQ2Error('Your answer to Question 2 is incorrect. Please try again.');
        } else {
          setQ2Error(null);
          if (!allAnswersQ2.length || !q2Ok) {
            newAllQ2 = [...allAnswersQ2, q2Selected];
            setAllAnswersQ2(newAllQ2);
          }
        }

        if (q1Ok && q2Ok) {
          sendDataToQualtrics('INSTRUCTIONS_COMPLETE', {
            completed: true,
            attentionCheck: attentionCheck,
            comprehension: comprehension,
            wrongCountDieterQ1: newWrongQ1,
            wrongCountDieterQ2: newWrongQ2,
            allAnswersDieterQ1: newAllQ1,
            allAnswersDieterQ2: newAllQ2
          });
        }
      };

      if (!ready) {
        return (
          <div className="min-h-screen bg-white flex items-center justify-center">
            <div className="text-gray-700 text-xl">Loading...</div>
          </div>
        );
      }

      const pages = [
        // Page 1: The Setup
        <section>
          <h2 className="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <span className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">1</span>
            The Setup
          </h2>
          <div className="bg-gray-50 rounded-xl p-4 space-y-4">
            <p className="text-gray-700">
              For this study, imagine the following:
            </p>
            <p className="text-gray-700">
              There are new products of two kinds:
            </p>
            <ul className="list-disc list-inside space-y-2 text-gray-600 ml-4">
              <li><strong className="text-gray-900">New functional beverages.</strong> These are drinks that have some effect on you, such as altering certain blood chemicals.</li>
              <li><strong className="text-gray-900">A new smartphone extension called BioClip</strong> that measures these blood chemicals.</li>
            </ul>
            <p className="text-gray-700 mt-4">
              It is known that each of the drinks affect one blood chemical. For instance,
            </p>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
              {EXAMPLES.map((ex, i) => (
                <div key={i} className="bg-white rounded-lg p-4 flex items-center gap-3 border border-gray-200 shadow-sm">
                  <span className="text-2xl">{ex.icon}</span>
                  <div>
                    <div className="text-gray-900 font-medium">{ex.drink}</div>
                    <div className="text-gray-500 text-sm">affects {ex.chemical}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>,

        // Page 2: What Happens Each Week
        <section>
          <h2 className="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <span className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">2</span>
            What Happens Each Week
          </h2>
          <div className="bg-gray-50 rounded-xl p-4">
            <p className="text-gray-700 mb-4">
              Each <span onClick={() => setAttentionCheck(1)} className={`cursor-pointer ${attentionCheck === 1 ? 'text-green-600' : ''}`}>Monday</span> morning, when you get up, you decide whether to consume the drink. Shortly after, your BioClip tells you whether your blood chemical level is normal. What you care about is whether you will feel good or bad later in the day.
            </p>
            <div className="flex flex-col md:flex-row items-stretch justify-around gap-4 py-4">
              {/* Step 1: Decision */}
              <div className="text-center flex flex-col items-center bg-white border border-gray-200 rounded-lg p-4 shadow-sm flex-1">
                <div className="mb-3">
                  <div className="text-gray-900 font-medium">Morning</div>
                  <div className="text-gray-500 text-sm">You decide: Drink or Skip?</div>
                </div>
                <div className="flex-1 flex items-center">
                  <div className="flex gap-2 justify-center">
                    <DrinkButtonMini name="Drink" type="drink" />
                    <DrinkButtonMini icon="‚äò" name="Skip" type="skip" />
                  </div>
                </div>
              </div>

              <div className="text-gray-400 text-2xl flex items-center justify-center">‚Üí</div>

              {/* Step 2: BioClip Reading */}
              <div className="text-center flex flex-col items-center bg-white border border-gray-200 rounded-lg p-4 shadow-sm flex-1">
                <div className="mb-3">
                  <div className="text-gray-900 font-medium">Shortly After</div>
                  <div className="text-gray-500 text-sm">BioClip shows chemical level</div>
                </div>
                <div className="flex-1 flex items-center">
                  <BioClipMini status={null} />
                </div>
              </div>

              <div className="text-gray-400 text-2xl flex items-center justify-center">‚Üí</div>

              {/* Step 3: Outcome */}
              <div className="text-center flex flex-col items-center bg-white border border-gray-200 rounded-lg p-4 shadow-sm flex-1">
                <div className="mb-3">
                  <div className="text-gray-900 font-medium">Later That Day</div>
                  <div className="text-gray-500 text-sm">How do you feel?</div>
                </div>
                <div className="flex-1 flex items-center">
                  <MoodMini mood={null} />
                </div>
              </div>
            </div>
            <p className="text-gray-700 mt-4">
              You make decisions only on Mondays. Because there's a whole week in between, what happens on one Monday does not affect what happens the next Monday..
            </p>
            <p className="text-gray-600 mt-4">
              To show you are following this, click the word "Monday" in the first sentence above. If you do not, the survey will terminate.
              {attentionCheck === 1 && <span className="text-green-600 ml-2">‚úì</span>}
            </p>
          </div>
        </section>,

        // Page 3: What You Know
        <section>
          <h2 className="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <span className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">3</span>
            What You Know vs. Don't Know
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="bg-green-50 border border-green-300 rounded-xl p-4">
              <h3 className="text-green-600 font-bold mb-2 flex items-center gap-2">
                <span>‚úì</span> What You Know
              </h3>
              <p className="text-gray-600">
                Consuming a drink makes it <strong className="text-gray-900">more likely</strong> that your blood chemical level will be <strong className="text-green-600">normal</strong>.
              </p>
            </div>
            <div className="bg-amber-50 border border-amber-300 rounded-xl p-4">
              <h3 className="text-amber-600 font-bold mb-2 flex items-center gap-2">
                <span>?</span> What You Don't Know
              </h3>
              <p className="text-gray-600">
                Whether having a normal or abnormal chemical level affects how you <strong className="text-gray-900">feel later that day</strong>.
              </p>
            </div>
          </div>
        </section>,

        // Page 4: Two Possibilities
        <section>
          <h2 className="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <span className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">4</span>
            Two Possibilities
          </h2>
          <div className="space-y-4">
            <p className="text-gray-700">For each blood chemical in this study, there are two possibilities:</p>
            <div className="bg-gray-50 rounded-xl p-4 border-l-4 border-blue-400">
              <h3 className="text-blue-600 font-bold mb-2">Possibility 1: The chemical level <span className="underline">is a cause</span> of how you feel.</h3>
              <p className="text-gray-600">
                Hence, normalizing your chemical level (by consuming the drink) <strong className="text-gray-900">raises the chance that you will feel good</strong> later that day.
              </p>
            </div>
            <div className="bg-gray-50 rounded-xl p-4 border-l-4 border-blue-400">
              <h3 className="text-blue-600 font-bold mb-2">Possibility 2: The chemical level <span className="underline">is a response to</span> how you feel, but <span className="underline">not a cause</span>.</h3>
              <p className="text-gray-600">
                In this case, drinking the beverage will still make a normal chemical level more likely, but this <strong className="text-gray-900">will not affect how you feel</strong>.
              </p>
            </div>
          </div>
        </section>,

        // Page 5: Note
        <section>
          <h2 className="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <span className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">5</span>
            Note
          </h2>
          <div className="bg-gray-50 rounded-xl p-4">
            <p className="text-gray-600">
              Because many things are going on in your body at any time, <strong className="text-gray-900">even effective decisions will not work 100% of the time</strong>. For instance, even though the beverage usually affects your blood chemical level:
            </p>
            <ul className="list-disc list-inside space-y-2 text-gray-600 mt-3 ml-4">
              <li>Sometimes it will be normal even if you don't drink the beverage</li>
              <li>Sometimes it will be abnormal even if you drink the beverage</li>
            </ul>
            <p className="text-gray-600 mt-3">
              Therefore, even effective decisions won't give you 100% control, they will only <strong className="text-gray-900">change the chance</strong> with which you feel a certain way.
            </p>
          </div>
        </section>,

        // Page 6: Payment
        <section>
          <h2 className="text-xl font-bold text-blue-600 mb-4 flex items-center gap-2">
            <span className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">6</span>
            Payment
          </h2>
          <div className="bg-gray-50 rounded-xl p-4">
            <div className="space-y-3">
              <div className="flex items-center gap-3 bg-gray-100 rounded-lg p-3">
                <span className="text-2xl">üí∞</span>
                <div>
                  <div className="text-gray-900 font-medium">Baseline Bonus</div>
                  <div className="text-gray-500">You begin each round with a baseline bonus of {CONFIG.currency}{CONFIG.basePay.toFixed(2)}.</div>
                </div>
              </div>
              <div className="flex items-center gap-3 bg-gray-100 rounded-lg p-3">
                <span className="text-2xl">ü•§</span>
                <div>
                  <div className="text-gray-900 font-medium">Drink Cost</div>
                  <div className="text-gray-500">If you consume the drink, you pay {CONFIG.currency}{CONFIG.aCost.toFixed(2)} for it (deducted from your baseline bonus).</div>
                </div>
              </div>
              <div className="flex items-center gap-3 bg-gray-100 rounded-lg p-3">
                <span className="text-2xl">üòä</span>
                <div>
                  <div className="text-gray-900 font-medium">Feeling Good Bonus</div>
                  <div className="text-gray-500">If you feel good at the end of the day, you receive an additional {CONFIG.currency}{CONFIG.yBonus.toFixed(2)} bonus, if you feel bad, you don't.</div>
                </div>
              </div>
              <div className="flex items-center gap-3 bg-gray-100 rounded-lg p-3">
                <span className="text-2xl">üìü</span>
                <div>
                  <div className="text-gray-900 font-medium">BioClip Reading</div>
                  <div className="text-gray-500">The BioClip's reading of your blood chemicals does not directly affect your payment.</div>
                </div>
              </div>
            </div>

            <p className="text-gray-600 mt-4">
              <strong className="text-gray-900">There will be {CONFIG.nRounds} rounds.</strong> This may sound like a lot, but because each round only takes a few seconds, this is quite manageable.
            </p>
            <p className="text-gray-600 mt-2">
              <strong className="text-gray-900">You will be paid for one round,</strong> selected at random at the end of the study.
            </p>
          </div>
        </section>,

        // Page 7: Comprehension Check
        <section>
          <div className="bg-gray-50 rounded-xl p-4">
            <p className="text-gray-900 font-bold mb-4">
              Which of the following statements about your payment are correct? <span className="font-normal text-gray-600">Select all that apply.</span>
            </p>
            <div className="space-y-3">
              {q1Items.map(item => (
                <label key={item.id} className="flex items-start gap-3 cursor-pointer group">
                  <input
                    type="checkbox"
                    checked={!!comprehension[item.id]}
                    onChange={() => setComprehension(prev => ({ ...prev, [item.id]: !prev[item.id] }))}
                    className="mt-1 w-5 h-5 rounded border-gray-300 bg-white text-blue-600 cursor-pointer flex-shrink-0"
                  />
                  <span className="text-gray-600 group-hover:text-gray-900 transition-colors">
                    {item.underline ? (<>{item.text}<span className="underline">{item.underline}</span>{item.after}</>) : item.text}
                  </span>
                </label>
              ))}
            </div>
            {q1Error && (
              <p className="text-red-600 mt-3 font-medium">{q1Error}</p>
            )}
          </div>

          <div className="bg-gray-50 rounded-xl p-4 mt-6">
            <p className="text-gray-900 font-bold mb-4">
              Which of the following statements about the study are correct? <span className="font-normal text-gray-600">Select all that apply.</span>
            </p>
            <div className="space-y-3">
              {q2Items.map(item => (
                <label key={item.id} className="flex items-start gap-3 cursor-pointer group">
                  <input
                    type="checkbox"
                    checked={!!comprehension[item.id]}
                    onChange={() => setComprehension(prev => ({ ...prev, [item.id]: !prev[item.id] }))}
                    className="mt-1 w-5 h-5 rounded border-gray-300 bg-white text-blue-600 cursor-pointer flex-shrink-0"
                  />
                  <span className="text-gray-600 group-hover:text-gray-900 transition-colors">
                    {item.underline ? (<>{item.text}<span className="underline">{item.underline}</span>{item.after}</>) : item.text}
                  </span>
                </label>
              ))}
            </div>
            {q2Error && (
              <p className="text-red-600 mt-3 font-medium">{q2Error}</p>
            )}
          </div>
        </section>
      ];

      const isLastPage = currentPage === totalPages - 1;

      return (
        <div className="min-h-screen bg-white p-4">
          <div className="max-w-5xl mx-auto">
            {/* Warning Banner - only on instruction pages */}
            {currentPage < 6 && (
              <div className="bg-amber-50 border border-amber-400 rounded-xl p-4 mb-6">
                <div className="flex items-center gap-3">
                  <span className="text-2xl">‚ö†Ô∏è</span>
                  <p className="text-amber-700 font-medium">
                    Do NOT click Next on any instructions page without having read all of it carefully. Otherwise, you will fail the attention check!
                  </p>
                </div>
              </div>
            )}

            {/* Main Content Card */}
            <div className="bg-white rounded-2xl p-6 border border-gray-200">
              <h1 className="text-3xl font-bold text-gray-900 mb-2 text-center">
                {currentPage < 6 ? 'Instructions' : 'Comprehension Check'}
              </h1>

              {currentPage >= 6 && (
                <p className="text-gray-600 italic text-center mb-4">
                  To make sure you have understood these instructions, please answer the following questions.
                </p>
              )}

              {/* Page indicator - only on instruction pages */}
              {currentPage < 6 && (
                <div className="flex items-center justify-center gap-2 mb-6">
                  {Array.from({ length: 6 }, (_, i) => (
                    <div
                      key={i}
                      className={`w-3 h-3 rounded-full transition-all ${
                        i === currentPage ? 'bg-blue-400 scale-125' : i < currentPage ? 'bg-blue-300' : 'bg-gray-200'
                      }`}
                    />
                  ))}
                  <span className="text-gray-500 text-sm ml-2">Page {currentPage + 1} of 6</span>
                </div>
              )}

              {/* Current page content */}
              {pages[currentPage]}

              {/* Navigation buttons */}
              <div className="flex justify-between items-center mt-8">
                <button
                  onClick={() => setCurrentPage(p => p - 1)}
                  disabled={currentPage === 0}
                  className={`px-6 py-3 rounded-xl font-bold transition-all ${
                    currentPage === 0
                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                      : 'bg-gray-200 hover:bg-gray-300 text-gray-700'
                  }`}
                >
                  Back
                </button>

                {isLastPage ? (
                  <button
                    onClick={handleContinue}
                    className="px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl transition-all"
                  >
                    Submit
                  </button>
                ) : (
                  <button
                    onClick={() => {
                      if (currentPage === 1 && attentionCheck === 0) {
                        sendDataToQualtrics('INSTRUCTIONS_COMPLETE', { completed: true, attentionCheck: 0, comprehension: {} });
                        return;
                      }
                      setCurrentPage(p => p + 1);
                    }}
                    className="px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all"
                  >
                    Next
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Render
    ReactDOM.createRoot(document.getElementById('root')).render(<Instructions />);
  </script>
</body>
</html>
